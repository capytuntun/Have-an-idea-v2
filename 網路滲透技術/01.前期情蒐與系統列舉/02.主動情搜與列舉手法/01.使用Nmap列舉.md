>[!NOTE]
nmap 是一種免費且開源的系統及網路掃描工具，他除了在滲透測試裡面擔任網路網路偵蒐的任務，也常被網路管理人員作為network inventory, managing service upgrade schedules的工具。

https://nmap.org/?source=post_page-----36ed094d6ef8---------------------------------------

- Nmap 使用範圍
	- Host discovery
	- Port scanning
	- Service enumeration and detection
	- OS detection
	- Scriptable interaction with the target service (Nmap Scripting Engine)

# 存活主機探索(Host Discovery)
>[!NTOE]
>當需要在某個子網的範圍內，搜索有開機的主機的時候，或是說探索這個子網內部有哪些主機時，可以用nmap的host discovery來做探索。

## 掃描整個子網
假設子網的ip是`192.168.1.0/24`，可以這樣執行。
```
nmap 192.168.1.0 -sn
```
- -sn : 關閉port scanning

如果需要彙整成清單的話，可以利用這個功能
```
nmap 192.168.1.0 -sn -oA tnet | grep for | cut -d" " -f5
```
- oA : 輸出成tnet格式
## 使用ip清單
>[!NOTE]
>假設手上有一個ip的清單，想要快速掌握那些ip位置有存活

- ip.txt
```
192.168.1.12
192.168.1.24
192.168.1.33
192.168.1.34
192.168.1.55
192.168.1.34
```

可以利用這樣的指令做掃描，來取得主機存活資訊
```
sudo nmap -sn -oA tnet -iL hosts.lst
```
## 同時掃描多個ip位置
```
nmap -sn -oA tnet 10.129.2.18 10.129.2.19 10.129.2.20| grep for | cut -d" " -f5
```

# 服務掃描
>[!NOTE]
>在系統攻擊前，需要先知道目標在執行那些服務，只知道ip是不夠的，所以我們需要利用一些工具來進行目標的列舉。
- Nmap主要可以刺探下列資訊
	- Open ports and its services
	- Service versions
	- Information that the services provided
	- Operating system

Nmap對於目標的掃描結果有幾個state:

| **State**          | **Description**                                                                                                                                                                                         |
| ------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `open`             | This indicates that the connection to the scanned port has been established. These connections can be **TCP connections**, **UDP datagrams** as well as **SCTP associations**.                          |
| `closed`           | When the port is shown as closed, the TCP protocol indicates that the packet we received back contains an `RST` flag. This scanning method can also be used to determine if our target is alive or not. |
| `filtered`         | Nmap cannot correctly identify whether the scanned port is open or closed because either no response is returned from the target for the port or we get an error code from the target.                  |
| `unfiltered`       | This state of a port only occurs during the **TCP-ACK** scan and means that the port is accessible, but it cannot be determined whether it is open or closed.                                           |
| `open\|filtered`   | If we do not get a response for a specific port, `Nmap` will set it to that state. This indicates that a firewall or packet filter may protect the port.                                                |
| `closed\|filtered` | This state only occurs in the **IP ID idle** scans and indicates that it was impossible to determine if the scanned port is closed or filtered by a firewall.                                           |
## 掃描TCP服務
>[!NOTE]
>利用Nmap掃描TCP port是最常見的用法，利用Nmap可以很快的發現主機使用的服務以及有開啟的port，以利後續的滲透。

Nmap預設會做1000個最常見的TCP port，並且使用SYN Scan
```
nmap 10.129.66.45
```

![Pasted image](images/Pasted_image_20250525033529.png)

可以利用參數做調整，使用`--top-ports`可以調整常用的port
``` 
 nmap 10.129.66.45 --top-ports=10 
```

![Pasted image](images/Pasted_image_20250525033633.png)

可以顯示Nmap顯示送出跟送回的封包
```
nmap 10.129.2.28 -p22,80,110 --packet-trace --disable-arp-ping -Pn -n --reason -sT
```
![Pasted image](images/Pasted_image_20250525034744.png)

Nmap的TCP常見使用指令:
- 常用的掃描指令
```
nmap -sS -p- -T4 192.168.100.1`
```
- Nmap掃描 Full-scan
```
nmap -p- 192.168.50.149
```
- 針對port位掃描
```
nmap -sC -sV -p80,135,445 192.168.100.1
```
- SYN-Scan
```
nmap -sS 192.168.50.149
```
- TCP-Scan
```
nmap -sT 192.168.50.149
```
## 掃描UDP服務
































